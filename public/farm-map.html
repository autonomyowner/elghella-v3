<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .map-container {
            padding: 20px;
            background: #f8f9fa;
        }
        
        #map {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #4CAF50;
        }
        
        /* Custom popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .farm-popup {
            text-align: center;
            font-family: 'Arial', sans-serif;
            direction: rtl;
        }
        
        .farm-popup h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.4em;
        }
        
        .farm-popup .crop-info {
            background: #f0f8f0;
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
        }
        
        .farm-popup .crop-type {
            color: #2e7d32;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .farm-popup .plant-date {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        /* Layer control styling */
        .leaflet-control-layers {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Info panel */
        .info-panel {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            direction: rtl;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            text-align: right;
        }
        
        .feature-icon {
            font-size: 1.5em;
            margin-left: 10px;
        }
        
        /* Soil Legend Styles */
        .legend {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            direction: rtl;
        }
        
        .legend-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            margin-left: 10px;
            border: 1px solid #ddd;
        }
        
        .legend-text {
            flex: 1;
            font-size: 0.9em;
        }
        
        .weather-info {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            direction: rtl;
            text-align: center;
        }
        
        .weather-current {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .weather-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .weather-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .weather-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            ๐พ Interactive Farm Map
        </div>
        
        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <!-- Enhanced Features Guide Panel -->
        <div class="info-panel">
            <h2>๐ฑ ุฏููู ุงุณุชุฎุฏุงู ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ</h2>
            <p>ุงุณุชูุดู ุงููุฒุงุฑุน ูุงูุญููู ุงูุฒุฑุงุนูุฉ ูู ุฌููุน ุฃูุญุงุก ุงูุฌุฒุงุฆุฑ</p>
            
            <!-- Main Features Grid -->
            <div class="features" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 25px;">
                <div class="feature" style="background: linear-gradient(135deg, #4CAF50, #45a049); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐</span>
                    <div>
                        <strong style="font-size: 1.1em;">ุนุฑุถ ุงูุฎุฑูุทุฉ</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ุชุจุฏูู ุจูู ุงูุฎุฑูุทุฉ ุงูุนุงุฏูุฉ ูุงูููุฑ ุงูุตูุงุนู</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            ๐ก ูุตูุญุฉ: ุงุณุชุฎุฏู ุงูุฎุฑูุทุฉ ุงูุณุงุชููุฉ ูุฑุคูุฉ ุญุงูุฉ ุงููุญุงุตูู ุงููุนููุฉ
                        </div>
                    </div>
                </div>
                
                <div class="feature" style="background: linear-gradient(135deg, #2196F3, #1976D2); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐</span>
                    <div>
                        <strong style="font-size: 1.1em;">ููุงูุน ุงููุฒุงุฑุน</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ุงููุฑ ุนูู ุงูุนูุงูุงุช ูุนุฑุถ ุชูุงุตูู ุดุงููุฉ</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            ๐ ุงูุจูุงูุงุช: ููุน ุงููุญุตููุ ุชุงุฑูุฎ ุงูุฒุฑุงุนุฉุ ุงููุณุงุญุฉุ ุงููุงูู
                        </div>
                    </div>
                </div>
                
                <div class="feature" style="background: linear-gradient(135deg, #FF9800, #F57C00); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐พ</span>
                    <div>
                        <strong style="font-size: 1.1em;">ุชุญููู ุงููุญุงุตูู</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ูุนูููุงุช ููุตูุฉ ุนู ุตุญุฉ ูุฅูุชุงุฌูุฉ ุงููุญุงุตูู</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            ๐ฏ ุงููุฏู: ุชุญุณูู ุงูุฅูุชุงุฌูุฉ ูุชูููู ุงูุชูุงููู
                        </div>
                    </div>
                </div>
                
                <div class="feature" style="background: linear-gradient(135deg, #9C27B0, #7B1FA2); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐ฑ</span>
                    <div>
                        <strong style="font-size: 1.1em;">ุจูุงูุงุช ุงูุชุฑุจุฉ</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ูุซุงูุฉ ุงููุฑุจูู ุงูุนุถูู ููุคุดุฑุงุช ุงูุฎุตูุจุฉ</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            ๐ ุงูุชูููู: ูู ุถุนูู ุฌุฏุงู ุฅูู ููุชุงุฒ (ุญุณุจ g/kg)
                        </div>
                    </div>
                </div>
                
                <div class="feature" style="background: linear-gradient(135deg, #00BCD4, #0097A7); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐ค๏ธ</span>
                    <div>
                        <strong style="font-size: 1.1em;">ูุนูููุงุช ุงูุทูุณ</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ุจูุงูุงุช ุญูุฉ ูุน ูุตุงุฆุญ ุฒุฑุงุนูุฉ</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            โฐ ุงูุชุญุฏูุซ: ูู 10 ุฏูุงุฆู ูู OpenWeatherMap
                        </div>
                    </div>
                </div>
                
                <div class="feature" style="background: linear-gradient(135deg, #f44336, #d32f2f); color: white; padding: 20px; border-radius: 12px; border: none;">
                    <span class="feature-icon" style="font-size: 2em; display: block; margin-bottom: 10px;">๐</span>
                    <div>
                        <strong style="font-size: 1.1em;">ุฃุฏูุงุช ุงูููุงุณ</strong>
                        <p style="margin: 8px 0; font-size: 0.9em; opacity: 0.9;">ููุงุณ ุงููุณุงูุงุช ููุณุฎ ุงูุฅุญุฏุงุซูุงุช</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 8px; border-radius: 6px; font-size: 0.8em; margin-top: 8px;">
                            โก ุณุฑูุน: ุงููุฑ ูุฑุชูู ูููุงุณ ุงููุณุงูุฉ ุจุฏูุฉ
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Quick Start Guide -->
            <div style="background: linear-gradient(135deg, #4CAF50, #2196F3); color: white; padding: 25px; border-radius: 15px; margin: 20px 0;">
                <h3 style="text-align: center; margin-bottom: 20px; font-size: 1.3em;">๐ ุฏููู ุงูุจุฏุงูุฉ ุงูุณุฑูุนุฉ</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; font-size: 0.9em;">
                    <div>
                        <h4 style="margin-bottom: 10px; display: flex; align-items: center;">
                            <span style="background: white; color: #4CAF50; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; margin-left: 8px; font-weight: bold;">1</span>
                            ุงุณุชูุดู ุงูุทุจูุงุช
                        </h4>
                        <p style="opacity: 0.9; margin-bottom: 15px;">ุงุณุชุฎุฏู ูุงุฆูุฉ ุงูุทุจูุงุช (ุฃุนูู ูููู ุงูุฎุฑูุทุฉ) ูุชูุนูู ุจูุงูุงุช ุงูุชุฑุจุฉ ูุงูุทูุณ</p>
                        
                        <h4 style="margin-bottom: 10px; display: flex; align-items: center;">
                            <span style="background: white; color: #4CAF50; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; margin-left: 8px; font-weight: bold;">2</span>
                            ุชูุงุนู ูุน ุงูุฎุฑูุทุฉ
                        </h4>
                        <p style="opacity: 0.9;">ุงููุฑ ูู ุฃู ููุงู ููุญุตูู ุนูู ุชุญููู ุดุงูู ูููููุน ูุงูุชุฑุจุฉ</p>
                    </div>
                    <div>
                        <h4 style="margin-bottom: 10px; display: flex; align-items: center;">
                            <span style="background: white; color: #4CAF50; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; margin-left: 8px; font-weight: bold;">3</span>
                            ุงูุชุดู ุงููุฒุงุฑุน
                        </h4>
                        <p style="opacity: 0.9; margin-bottom: 15px;">ุงููุฑ ุนูู ุฃููููุงุช ุงููุฒุงุฑุน ๐พ ูุฑุคูุฉ ูุนูููุงุช ููุตูุฉ</p>
                        
                        <h4 style="margin-bottom: 10px; display: flex; align-items: center;">
                            <span style="background: white; color: #4CAF50; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 0.8em; margin-left: 8px; font-weight: bold;">4</span>
                            ุงุณุชุฎุฏู ุงูุฃุฏูุงุช
                        </h4>
                        <p style="opacity: 0.9;">ุงุณุชูุฏ ูู ุฃุฏูุงุช ุงูููุงุณ ููุณุฎ ุงูุฅุญุฏุงุซูุงุช ูุชุญููู ุงููุณุงูุงุช</p>
                    </div>
                </div>
            </div>
            
            <!-- Pro Tips -->
            <div style="background: white; border: 2px solid #FF9800; border-radius: 12px; padding: 20px; margin-top: 20px;">
                <h3 style="color: #FF9800; margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
                    <span style="margin-left: 8px; font-size: 1.2em;">๐ก</span>
                    ูุตุงุฆุญ ุงููุญุชุฑููู
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; font-size: 0.9em;">
                    <div style="display: flex; align-items: flex-start; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <span style="color: #FF9800; margin-left: 8px; font-size: 1.1em;">๏ฟฝ</span>
                        <span><strong>ูุฃูุถู ูุชุงุฆุฌ:</strong> ุงุณุชุฎุฏู ุทุจูุฉ ุงูุณุงุชู ูุน ุจูุงูุงุช ุงูุชุฑุจุฉ ูุนุงู</span>
                    </div>
                    <div style="display: flex; align-items: flex-start; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <span style="color: #FF9800; margin-left: 8px; font-size: 1.1em;">โก</span>
                        <span><strong>ููุณุฑุนุฉ:</strong> ุงุทูุน ุนูู ุงูุทูุณ ูุจู ุงูุชุฎุทูุท ููุฃูุดุทุฉ ุงูุฒุฑุงุนูุฉ</span>
                    </div>
                    <div style="display: flex; align-items: flex-start; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <span style="color: #FF9800; margin-left: 8px; font-size: 1.1em;">๐</span>
                        <span><strong>ููุฏูุฉ:</strong> ุงุณุชุฎุฏู ุฃุฏุงุฉ ุงูููุงุณ ูุญุณุงุจ ูุณุงุญุงุช ุงูุญููู</span>
                    </div>
                    <div style="display: flex; align-items: flex-start; padding: 10px; background: #fff3e0; border-radius: 8px;">
                        <span style="color: #FF9800; margin-left: 8px; font-size: 1.1em;">๐ฑ</span>
                        <span><strong>ูููุดุงุฑูุฉ:</strong> ุงูุณุฎ ุงูุฅุญุฏุงุซูุงุช ููุดุงุฑูุฉ ุงูููุงูุน ูุน ุงูุขุฎุฑูู</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Weather Information Panel with Guide -->
        <div class="weather-info" id="weather-panel">
            <h2>๐ค๏ธ ุฏููู ูุนูููุงุช ุงูุทูุณ ุงูุญุงููุฉ - ุงูุฌุฒุงุฆุฑ</h2>
            
            <!-- Current Weather Data -->
            <div class="weather-current" id="weather-data">
                <div class="weather-item">
                    <div class="weather-value" id="temperature">--ยฐC</div>
                    <div class="weather-label">ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="humidity">--%</div>
                    <div class="weather-label">ุงูุฑุทูุจุฉ</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="wind-speed">-- ู/ุซ</div>
                    <div class="weather-label">ุณุฑุนุฉ ุงูุฑูุงุญ</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="weather-desc">--</div>
                    <div class="weather-label">ูุตู ุงูุทูุณ</div>
                </div>
            </div>
            
            <!-- Weather Guide -->
            <div style="background: rgba(255,255,255,0.1); margin-top: 20px; padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                <h3 style="text-align: center; margin-bottom: 15px; font-size: 1.2em;">๐ ุฏููู ูุฑุงุกุฉ ุจูุงูุงุช ุงูุทูุณ ูููุฒุงุฑุนูู</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px; font-size: 0.9em;">
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: #ffeb3b;">๐ก๏ธ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ ุงููุซูู ูููุญุงุตูู:</h4>
                        <div style="space-y: 5px;">
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>โข ุงูููุญ:</span>
                                <span style="font-weight: bold;">15-20ยฐC</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>โข ุงูุทูุงุทู:</span>
                                <span style="font-weight: bold;">20-25ยฐC</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>โข ุงูุฒูุชูู:</span>
                                <span style="font-weight: bold;">15-30ยฐC</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                                <span>โข ุงููุฎูู:</span>
                                <span style="font-weight: bold;">25-35ยฐC</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: #2196F3;">๐ง ูุคุดุฑ ุงูุฑุทูุจุฉ ูุงูุฑู:</h4>
                        <div style="margin: 8px 0; display: flex; align-items: center;">
                            <div style="width: 12px; height: 12px; background: #f44336; border-radius: 50%; margin-left: 8px;"></div>
                            <span>ุฃูู ูู 30%: ุฑู ููุซู ูุทููุจ</span>
                        </div>
                        <div style="margin: 8px 0; display: flex; align-items: center;">
                            <div style="width: 12px; height: 12px; background: #FF9800; border-radius: 50%; margin-left: 8px;"></div>
                            <span>30-60%: ุฑู ูุนุชุฏู</span>
                        </div>
                        <div style="margin: 8px 0; display: flex; align-items: center;">
                            <div style="width: 12px; height: 12px; background: #4CAF50; border-radius: 50%; margin-left: 8px;"></div>
                            <span>60-80%: ุฑู ุฎููู</span>
                        </div>
                        <div style="margin: 8px 0; display: flex; align-items: center;">
                            <div style="width: 12px; height: 12px; background: #2196F3; border-radius: 50%; margin-left: 8px;"></div>
                            <span>ุฃูุซุฑ ูู 80%: ุชูููุฉ ูุทููุจุฉ</span>
                        </div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: #4CAF50;">๐จ ุชุฃุซูุฑ ุงูุฑูุงุญ ุนูู ุงูุฒุฑุงุนุฉ:</h4>
                        <div style="margin: 5px 0;">โข <strong>ุฃูู ูู 2 ู/ุซ:</strong> ูุซุงูู ููุฒุฑุงุนุฉ</div>
                        <div style="margin: 5px 0;">โข <strong>2-5 ู/ุซ:</strong> ุฌูุฏ ููุชูููุญ ุงูุทุจูุนู</div>
                        <div style="margin: 5px 0;">โข <strong>5-10 ู/ุซ:</strong> ูุฏ ูุคุซุฑ ุนูู ุงููุจุงุชุงุช ุงูุตุบูุฑุฉ</div>
                        <div style="margin: 5px 0;">โข <strong>ุฃูุซุฑ ูู 10 ู/ุซ:</strong> ุถุงุฑุ ุญูุงูุฉ ุงููุญุงุตูู</div>
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: #9C27B0;">๐ฆ๏ธ ูุตุงุฆุญ ุญุณุจ ุญุงูุฉ ุงูุทูุณ:</h4>
                        <div style="margin: 5px 0;">โข <strong>ูุดูุณ:</strong> ููุช ูุซุงูู ููุญุตุงุฏ ูุงูุชุฌููู</div>
                        <div style="margin: 5px 0;">โข <strong>ุบุงุฆู:</strong> ุฌูุฏ ููุฒุฑุงุนุฉ ูุงูุฑู</div>
                        <div style="margin: 5px 0;">โข <strong>ูุงุทุฑ:</strong> ุชุฌูุจ ุงูุฑุด ูุงูุชุณููุฏ</div>
                        <div style="margin: 5px 0;">โข <strong>ุนุงุตู:</strong> ุญูุงูุฉ ุงููุจุงุชุงุช ุงูุญุณุงุณุฉ</div>
                    </div>
                </div>
                
                <!-- Weather Actions -->
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.2); text-align: center; font-size: 0.8em; opacity: 0.8;">
                    ๐ก ุงูุจูุงูุงุช ูุญุฏุซุฉ ูู 10 ุฏูุงุฆู ูู OpenWeatherMap โข ุขุฎุฑ ุชุญุฏูุซ: <span id="last-update"></span>
                </div>
            </div>
        </div>
        
        <!-- Map Tools Guide -->
        <div style="background: linear-gradient(135deg, #6366f1, #9333ea); color: white; margin: 20px; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
            <h2 style="text-align: center; margin-bottom: 20px; font-size: 1.5em;">๐ ุฏููู ุฃุฏูุงุช ุงูููุงุณ ูุงูุชูุงุนู</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                    <h3 style="margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
                        <span style="margin-left: 10px; font-size: 1.5em;">๐ฑ๏ธ</span>
                        ุงูุชุญูู ุจุงูุฎุฑูุทุฉ
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fbbf24; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ุงูููุฑ:</strong> ุชุญููู ุงููููุน ูุงูุชุฑุจุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fbbf24; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ุงูุณุญุจ:</strong> ุชุญุฑูู ุงูุฎุฑูุทุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fbbf24; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ุงูุนุฌูุฉ:</strong> ุชูุจูุฑ ูุชุตุบูุฑ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fbbf24; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ุงูููุฑ ุนูู ๐พ:</strong> ูุนูููุงุช ุงููุฒุฑุนุฉ</span>
                        </li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                    <h3 style="margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
                        <span style="margin-left: 10px; font-size: 1.5em;">๐ง</span>
                        ุฃุฏูุงุช ูุชูุฏูุฉ
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #60a5fa; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ููุงุณ ุงููุณุงูุฉ:</strong> ุฒุฑ "๐ ููุงุณ" ุซู ููุฑุชุงู</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #60a5fa; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ูุณุญ ุงูููุงุณุงุช:</strong> ุฒุฑ "๐๏ธ ูุณุญ"</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #60a5fa; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ูุณุฎ ุงูุฅุญุฏุงุซูุงุช:</strong> ูู ูุงูุฐุฉ ุงููููุน</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #60a5fa; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>ุทุจูุงุช ุงูุจูุงูุงุช:</strong> ูุงุฆูุฉ ุฃุนูู ุงููููู</span>
                        </li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                    <h3 style="margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
                        <span style="margin-left: 10px; font-size: 1.5em;">๐</span>
                        ุทุจูุงุช ุงูุฎุฑูุทุฉ
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #34d399; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>๐บ๏ธ ุนุงุฏูุฉ:</strong> ุงูุฎุฑูุทุฉ ุงูุชูููุฏูุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #34d399; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>๐ฐ๏ธ ุณุงุชู:</strong> ุตูุฑ ุฌููุฉ ุญููููุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #34d399; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>๐ฑ ุชุฑุจุฉ:</strong> ุจูุงูุงุช ุงูุฎุตูุจุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #34d399; border-radius: 50%; margin-left: 8px;"></span>
                            <span><strong>๐ค๏ธ ุทูุณ:</strong> ุจูุงูุงุช ุฌููุฉ ูุจุงุดุฑุฉ</span>
                        </li>
                    </ul>
                </div>
                
                <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                    <h3 style="margin-bottom: 15px; display: flex; align-items: center; font-size: 1.2em;">
                        <span style="margin-left: 10px; font-size: 1.5em;">๐ก</span>
                        ูุตุงุฆุญ ุณุฑูุนุฉ
                    </h3>
                    <ul style="list-style: none; padding: 0; margin: 0; font-size: 0.9em;">
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fb923c; border-radius: 50%; margin-left: 8px;"></span>
                            <span>ูุนูู ุนุฏุฉ ุทุจูุงุช ูุนุงู ููููุงุฑูุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fb923c; border-radius: 50%; margin-left: 8px;"></span>
                            <span>ุงุณุชุฎุฏู ุงูุณุงุชู ูุฑุคูุฉ ุญุงูุฉ ุงููุญุงุตูู</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fb923c; border-radius: 50%; margin-left: 8px;"></span>
                            <span>ุงุญูุธ ุงูุฅุญุฏุงุซูุงุช ุงููููุฉ</span>
                        </li>
                        <li style="margin: 8px 0; display: flex; align-items: center;">
                            <span style="width: 8px; height: 8px; background: #fb923c; border-radius: 50%; margin-left: 8px;"></span>
                            <span>ุฑุงูุจ ุงูุทูุณ ูุจู ุงูุนูู ุงูุฒุฑุงุนู</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Soil Carbon Legend -->
        <div class="legend">
            <div class="legend-title">๐ฑ ุฏููู ูุซุงูุฉ ุงููุฑุจูู ุงูุนุถูู ูู ุงูุชุฑุจุฉ</div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #8B4513;"></div>
                <div class="legend-text">
                    <strong>ุนุงูู ุฌุฏุงู (> 25 g/kg):</strong> ุชุฑุจุฉ ุฎุตุจุฉ ุฌุฏุงูุ ูุซุงููุฉ ููุฒุฑุงุนุฉ ุงููุซููุฉ
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #A0522D;"></div>
                <div class="legend-text">
                    <strong>ุนุงูู (15-25 g/kg):</strong> ุชุฑุจุฉ ุฎุตุจุฉุ ุฌูุฏุฉ ูููุญุงุตูู ุงููุชููุนุฉ
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #CD853F;"></div>
                <div class="legend-text">
                    <strong>ูุชูุณุท (8-15 g/kg):</strong> ุชุฑุจุฉ ูุชูุณุทุฉ ุงูุฎุตูุจุฉุ ุชุญุชุงุฌ ุชุญุณูู
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #F4A460;"></div>
                <div class="legend-text">
                    <strong>ููุฎูุถ (3-8 g/kg):</strong> ุชุฑุจุฉ ุถุนููุฉุ ุชุญุชุงุฌ ุชุณููุฏ ุนุถูู
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #FFEFD5;"></div>
                <div class="legend-text">
                    <strong>ููุฎูุถ ุฌุฏุงู (< 3 g/kg):</strong> ุชุฑุจุฉ ุบูุฑ ุตุงูุญุฉ ููุฒุฑุงุนุฉ
                </div>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 8px; font-size: 0.9em;">
                <strong>๐ก ูุนูููุฉ ูููุฉ:</strong> ุงููุฑุจูู ุงูุนุถูู ูู ุงูุชุฑุจุฉ ูุคุดุฑ ุญููู ูุฎุตูุจุฉ ุงูุฃุฑุถ ููุฏุฑุชูุง ุนูู ุงูุงุญุชูุงุธ ุจุงููุงุก ูุงููุบุฐูุงุช. 
                ูููุง ุฒุงุฏ ุงููุญุชูู ุงูุนุถููุ ูุงูุช ุงูุชุฑุจุฉ ุฃูุซุฑ ุตุญุฉ ูุฅูุชุงุฌูุฉ.
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize map centered on Algeria (broader view)
        const map = L.map('map').setView([28.0339, 1.6596], 6);

        // Define base layers
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'ยฉ OpenStreetMap contributors',
            maxZoom: 19
        });

        // Esri Satellite imagery layer
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles ยฉ Esri โ Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });

        // Add default layer (OSM)
        osmLayer.addTo(map);

        // ๐ฑ SOIL DATA LAYER - ISRIC SoilGrids
        const soilLayer = L.tileLayer.wms('https://maps.isric.org/mapserv', {
            layers: 'ocd_0-5cm_mean',
            format: 'image/png',
            transparent: true,
            attribution: 'Soil data ยฉ ISRIC SoilGrids',
            opacity: 0.7,
            zIndex: 200
        });

        // ๐ค๏ธ WEATHER LAYERS - OpenWeatherMap
        const API_KEY = '06dbb6c0777805cea0cc1dcbeb83e18c';
        
        const precipitationLayer = L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data ยฉ OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const temperatureLayer = L.tileLayer(`https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data ยฉ OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const windLayer = L.tileLayer(`https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data ยฉ OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const cloudsLayer = L.tileLayer(`https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data ยฉ OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        // Create base and overlay layer controls
        const baseLayers = {
            "๐บ๏ธ ุงูุฎุฑูุทุฉ ุงูุนุงุฏูุฉ": osmLayer,
            "๐ฐ๏ธ ุตูุฑ ุงูุฃููุงุฑ ุงูุตูุงุนูุฉ": satelliteLayer
        };

        // ๐ฑ CREATE VISIBLE SOIL DEMO LAYER
        const createSoilDemoLayer = () => {
            const soilDemoLayer = L.layerGroup();
            
            const soilZones = [
                {
                    center: [36.7538, 3.0588],
                    radius: 2000,
                    color: '#8B4513',
                    fillColor: '#8B4513',
                    fillOpacity: 0.3,
                    popup: 'ููุทูุฉ ุนุงููุฉ ุงูุฎุตูุจุฉ - ูุซุงูุฉ ูุฑุจูู ุนุถูู: 28 g/kg'
                },
                {
                    center: [36.7608, 3.0688],
                    radius: 1500,
                    color: '#A0522D',
                    fillColor: '#A0522D',
                    fillOpacity: 0.3,
                    popup: 'ููุทูุฉ ุฎุตุจุฉ - ูุซุงูุฉ ูุฑุจูู ุนุถูู: 18 g/kg'
                },
                {
                    center: [36.7458, 3.0488],
                    radius: 1800,
                    color: '#CD853F',
                    fillColor: '#CD853F',
                    fillOpacity: 0.3,
                    popup: 'ููุทูุฉ ูุชูุณุทุฉ ุงูุฎุตูุจุฉ - ูุซุงูุฉ ูุฑุจูู ุนุถูู: 12 g/kg'
                },
                {
                    center: [36.7638, 3.0788],
                    radius: 1200,
                    color: '#F4A460',
                    fillColor: '#F4A460',
                    fillOpacity: 0.3,
                    popup: 'ููุทูุฉ ุถุนููุฉ ุงูุฎุตูุจุฉ - ูุซุงูุฉ ูุฑุจูู ุนุถูู: 6 g/kg'
                },
                {
                    center: [36.7338, 3.0388],
                    radius: 1000,
                    color: '#FFEFD5',
                    fillColor: '#FFEFD5',
                    fillOpacity: 0.4,
                    popup: 'ููุทูุฉ ุถุนููุฉ ุฌุฏุงู - ูุซุงูุฉ ูุฑุจูู ุนุถูู: 2 g/kg'
                }
            ];

            soilZones.forEach(zone => {
                const circle = L.circle(zone.center, {
                    radius: zone.radius,
                    color: zone.color,
                    fillColor: zone.fillColor,
                    fillOpacity: zone.fillOpacity,
                    weight: 2
                }).bindPopup(`
                    <div style="text-align: center; direction: rtl;">
                        <h4>๐ฑ ุชุญููู ุงูุชุฑุจุฉ</h4>
                        <p>${zone.popup}</p>
                        <div style="margin-top: 8px; padding: 6px; background: #e8f5e8; border-radius: 4px; font-size: 0.85em;">
                            ๐ก ุจูุงูุงุช ุชุฌุฑูุจูุฉ ููููุทูุฉ
                        </div>
                    </div>
                `);
                soilDemoLayer.addLayer(circle);
            });

            return soilDemoLayer;
        };

        const soilDemoLayer = createSoilDemoLayer();

        const overlayLayers = {
            "๐ฑ ููุงุทู ุฎุตูุจุฉ ุงูุชุฑุจุฉ (ุชุฌุฑูุจูุฉ)": soilDemoLayer,
            "๏ฟฝ ุจูุงูุงุช ุงูุชุฑุจุฉ ุงูุนุงูููุฉ": soilLayer,
            "๏ฟฝ๏ธ ูุทูู ุงูุฃูุทุงุฑ (ูุจุงุดุฑ)": precipitationLayer,
            "๐ก๏ธ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ (ูุจุงุดุฑ)": temperatureLayer,
            "๐จ ุงูุฑูุงุญ (ูุจุงุดุฑ)": windLayer,
            "โ๏ธ ุงูุบููู (ูุจุงุดุฑ)": cloudsLayer
        };

        // Add layer control with overlays
        L.control.layers(baseLayers, overlayLayers, {
            position: 'topright',
            collapsed: false
        }).addTo(map);

        // Add demo soil layer by default so users see it immediately!
        soilDemoLayer.addTo(map);
        
        // Also add precipitation layer for immediate visual impact
        precipitationLayer.addTo(map);

        // Fixed farm icon - more reliable approach
        const farmIcon = L.divIcon({
            html: '๐พ',
            iconSize: [30, 30],
            className: 'farm-marker-icon',
            iconAnchor: [15, 15]
        });

        // Add farm icon styles
        const iconStyle = document.createElement('style');
        iconStyle.textContent = `
            .farm-marker-icon {
                background: #4CAF50 !important;
                color: white !important;
                border-radius: 50% !important;
                width: 40px !important;
                height: 40px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                font-size: 20px !important;
                box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4) !important;
                border: 3px solid white !important;
                transition: all 0.3s ease !important;
                cursor: pointer !important;
            }
            .farm-marker-icon:hover {
                transform: scale(1.15) !important;
                box-shadow: 0 6px 20px rgba(76, 175, 80, 0.6) !important;
                background: #45a049 !important;
            }
        `;
        document.head.appendChild(iconStyle);

        // Add farm markers with detailed information
        const farms = [
            {
                coords: [36.7538, 3.0588],
                name: "ูุฒุฑุนุฉ ุงูุฃูู",
                crop: "ุงูููุญ",
                plantedDate: "ูุงุฑุณ 2024",
                area: "15 ููุชุงุฑ",
                owner: "ูุญูุฏ ุฃุญูุฏ"
            },
            {
                coords: [36.7608, 3.0688],
                name: "ุญูู ุงูุฒูุชูู ุงููุจุงุฑู",
                crop: "ุฃุดุฌุงุฑ ุงูุฒูุชูู",
                plantedDate: "ุฃูุชูุจุฑ 2020",
                area: "8 ููุชุงุฑ",
                owner: "ูุงุทูุฉ ุจู ุนูู"
            },
            {
                coords: [36.7458, 3.0488],
                name: "ูุฒุฑุนุฉ ุงููุฌุงุญ",
                crop: "ุงูุทูุงุทู",
                plantedDate: "ุฃุจุฑูู 2024",
                area: "3 ููุชุงุฑ",
                owner: "ุนุจุฏ ุงูุฑุญูู ูุญููุฏ"
            },
            {
                coords: [36.7638, 3.0788],
                name: "ุญูู ุงูุจุฑูุฉ",
                crop: "ุงูุฐุฑุฉ",
                plantedDate: "ูุงูู 2024",
                area: "12 ููุชุงุฑ",
                owner: "ุฎุฏูุฌุฉ ููุณู"
            },
            {
                coords: [36.7338, 3.0388],
                name: "ูุฒุฑุนุฉ ุงูุฎูุฑ",
                crop: "ุงูุจุฑุชูุงู",
                plantedDate: "ููููุจุฑ 2021",
                area: "6 ููุชุงุฑ",
                owner: "ุฃุญูุฏ ุงูุนุฑุจู"
            }
        ];

        // Add markers to map
        farms.forEach(farm => {
            const marker = L.marker(farm.coords, { icon: farmIcon }).addTo(map);
            
            const popupContent = `
                <div class="farm-popup">
                    <h3>๐พ ${farm.name}</h3>
                    <div class="crop-info">
                        <div class="crop-type">๐ฑ ููุน ุงููุญุตูู: ${farm.crop}</div>
                        <div class="plant-date">๐ ุชุงุฑูุฎ ุงูุฒุฑุงุนุฉ: ${farm.plantedDate}</div>
                        <div class="plant-date">๐ ุงููุณุงุญุฉ: ${farm.area}</div>
                        <div class="plant-date">๐จโ๐พ ุงููุงูู: ${farm.owner}</div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 5px; font-size: 0.9em;">
                        ๐ก ุงููุฑ ูุนุฑุถ ุงููุฒูุฏ ูู ุงูุชูุงุตูู
                    </div>
                </div>
            `;
            
            marker.bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup'
            });
        });

        // Add a scale control
        L.control.scale().addTo(map);

        // Add custom zoom control with Arabic labels
        map.removeControl(map.zoomControl);
        L.control.zoom({
            zoomInTitle: 'ุชูุจูุฑ',
            zoomOutTitle: 'ุชุตุบูุฑ'
        }).addTo(map);

        // Add location marker for current position (if available)
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;
                
                const userIcon = L.divIcon({
                    html: '<div style="background: #ff4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 2px solid white;">๐</div>',
                    iconSize: [20, 20],
                    className: 'user-location-icon'
                });
                
                L.marker([userLat, userLng], { icon: userIcon })
                    .addTo(map)
                    .bindPopup('๐ ูููุนู ุงูุญุงูู')
                    .openPopup();
            });
        }

        // ๐ค๏ธ FETCH LIVE WEATHER DATA
        async function fetchWeatherData() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=36.7538&lon=3.0588&appid=${API_KEY}&units=metric&lang=ar`);
                const data = await response.json();
                
                // Update weather display
                document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}ยฐC`;
                document.getElementById('humidity').textContent = `${data.main.humidity}%`;
                document.getElementById('wind-speed').textContent = `${data.wind.speed} ู/ุซ`;
                document.getElementById('weather-desc').textContent = data.weather[0].description;
                
                // Update last update time
                const lastUpdateElement = document.getElementById('last-update');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = new Date().toLocaleTimeString('ar-DZ');
                }
                
                console.log('๐ค๏ธ Weather data loaded successfully!');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชุญููู ุจูุงูุงุช ุงูุทูุณ:', error);
                document.getElementById('temperature').textContent = 'ุบูุฑ ูุชููุฑ';
                document.getElementById('humidity').textContent = 'ุบูุฑ ูุชููุฑ';
                document.getElementById('wind-speed').textContent = 'ุบูุฑ ูุชููุฑ';
                document.getElementById('weather-desc').textContent = 'ุบูุฑ ูุชููุฑ';
                
                // Update last update time even for errors
                const lastUpdateElement = document.getElementById('last-update');
                if (lastUpdateElement) {
                    lastUpdateElement.textContent = 'ุฎุทุฃ ูู ุงูุชุญุฏูุซ';
                }
            }
        }

        // Load weather data on page load
        fetchWeatherData();
        
        // Update weather data every 10 minutes
        setInterval(fetchWeatherData, 600000);

        // Enhanced map click event with REAL location analysis
        map.on('click', async function(e) {
            console.log('๐ Map clicked at: ' + e.latlng);
            
            // Get real geographical data
            const lat = e.latlng.lat;
            const lng = e.latlng.lng;
            
            // Determine real Algerian region based on coordinates
            let region, province, climate, soilType, elevation, precipitation, soilFertility, organicCarbon, soilColor, recommendedCrops, irrigation;
            
            if (lat > 35.5 && lng < 1) {
                region = 'ุงูุดูุงู ุงูุบุฑุจู';
                province = 'ููุฑุงูุ ุชููุณุงู';
                climate = 'ูุชูุณุทู';
                soilType = 'ุทูููุฉ ุฎุตุจุฉ';
                elevation = '0-400ู';
                precipitation = '400-600 ูู/ุณูุฉ';
                soilFertility = 'ุฌูุฏุฉ ุฅูู ููุชุงุฒุฉ';
                organicCarbon = '18-30 g/kg';
                soilColor = '#8B4513';
                recommendedCrops = 'ุงูุญูุถูุงุชุ ุงูุฒูุชููุ ุงูููุญ';
                irrigation = 'ุฑู ุชููููู + ูุทุฑู';
            } else if (lat > 35.5 && lng >= 1 && lng < 4) {
                region = 'ุงููุณุท ุงูุดูุงูู';
                province = 'ุงูุฌุฒุงุฆุฑุ ุงูุจููุฏุฉุ ุจููุฑุฏุงุณ';
                climate = 'ูุชูุณุทู ูุนุชุฏู';
                soilType = 'ุทูููุฉ ุฑูููุฉ';
                elevation = '0-300ู';
                precipitation = '600-800 ูู/ุณูุฉ';
                soilFertility = 'ููุชุงุฒุฉ';
                organicCarbon = '22-35 g/kg';
                soilColor = '#8B4513';
                recommendedCrops = 'ุงูุฎุถุฑูุงุชุ ุงูููุงููุ ุงูููุญ';
                irrigation = 'ุฑู ุชููููู';
            } else if (lat > 35.5 && lng >= 4) {
                region = 'ุงูุดูุงู ุงูุดุฑูู';
                province = 'ูุณูุทููุฉุ ุนูุงุจุฉุ ุณูููุฏุฉ';
                climate = 'ูุชูุณุทู ูุงุฑู';
                soilType = 'ุทูููุฉ ููุณูุฉ';
                elevation = '200-500ู';
                precipitation = '500-700 ูู/ุณูุฉ';
                soilFertility = 'ุฌูุฏุฉ';
                organicCarbon = '15-25 g/kg';
                soilColor = '#A0522D';
                recommendedCrops = 'ุงูููุญุ ุงูุดุนูุฑุ ุงูุจููููุงุช';
                irrigation = 'ุฑู ุชููููู + ูุทุฑู';
            } else if (lat > 33 && lat <= 35.5) {
                region = 'ุงููุถุงุจ ุงูุนููุง';
                province = 'ุชูุงุฑุชุ ุณุทููุ ุงููุณููุฉ';
                climate = 'ุดุจู ูุงุญู';
                soilType = 'ุทูููุฉ ุฑูููุฉ';
                elevation = '500-1200ู';
                precipitation = '200-400 ูู/ุณูุฉ';
                soilFertility = 'ูุชูุณุทุฉ';
                organicCarbon = '8-18 g/kg';
                soilColor = '#CD853F';
                recommendedCrops = 'ุงูููุญ ุงูุตูุจุ ุงูุดุนูุฑุ ุงูุนุฏุณ';
                irrigation = 'ุฑู ุถุฑูุฑู';
            } else {
                region = 'ุงูุตุญุฑุงุก';
                province = 'ูุฑููุฉุ ุบุฑุฏุงูุฉุ ุชููุฑุงุณุช';
                climate = 'ุตุญุฑุงูู ุฌุงู';
                soilType = 'ุฑูููุฉ ูุงุญูุฉ';
                elevation = '200-2000ู';
                precipitation = '10-100 ูู/ุณูุฉ';
                soilFertility = 'ููุฎูุถุฉ';
                organicCarbon = '1-5 g/kg';
                soilColor = '#F4A460';
                recommendedCrops = 'ุงููุฎููุ ุงููุจุงุชุงุช ุงูุตุญุฑุงููุฉ';
                irrigation = 'ุฑู ุจุงูุชูููุท';
            }
            
            // Get live weather for the clicked location
            let currentTemp = '--', currentHumidity = '--', currentWind = '--', weatherCondition = '--';
            try {
                const API_KEY = '06dbb6c0777805cea0cc1dcbeb83e18c';
                const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${API_KEY}&units=metric&lang=ar`);
                if (weatherResponse.ok) {
                    const weatherData = await weatherResponse.json();
                    currentTemp = `${Math.round(weatherData.main.temp)}ยฐC`;
                    currentHumidity = `${weatherData.main.humidity}%`;
                    currentWind = `${Math.round(weatherData.wind.speed * 10) / 10} ู/ุซ`;
                    weatherCondition = weatherData.weather[0].description || 'ุบุงุฆู ุฌุฒุฆูุงู';
                }
            } catch (error) {
                console.log('Weather data not available for this location');
            }
            
            // Calculate distances from major cities
            const algiersDistance = Math.round(L.latLng(36.7538, 3.0588).distanceTo(e.latlng) / 1000);
            const oranDistance = Math.round(L.latLng(35.6976, -0.6337).distanceTo(e.latlng) / 1000);
            const constantineDistance = Math.round(L.latLng(36.3650, 6.6147).distanceTo(e.latlng) / 1000);
            
            // Show comprehensive location analysis popup
            const popup = L.popup()
                .setLatLng(e.latlng)
                .setContent(`
                    <div style="text-align: center; direction: rtl; min-width: 320px;">
                        <h4 style="color: #4CAF50; margin-bottom: 12px;">๐ ุชุญููู ุงููููุน ุงูุญูููู</h4>
                        
                        <!-- ุงููููุน ุงูุฌุบุฑุงูู -->
                        <div style="background: #f5f5f5; padding: 12px; border-radius: 8px; margin: 8px 0;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #333;">๐บ๏ธ ุงููููุน ุงูุฌุบุฑุงูู</div>
                            <div style="font-size: 0.85em; color: #666; text-align: right;">
                                <strong>ุงูููุทูุฉ:</strong> ${region}<br>
                                <strong>ุงูููุงูุฉ:</strong> ${province}<br>
                                <strong>ุงูุฅุญุฏุงุซูุงุช:</strong> ${lat.toFixed(4)}, ${lng.toFixed(4)}<br>
                                <strong>ุงูุงุฑุชูุงุน:</strong> ${elevation}<br>
                                <strong>ุงููุณุงูุฉ ูู ุงูุฌุฒุงุฆุฑ:</strong> ${algiersDistance} ูู
                            </div>
                        </div>

                        <!-- ุชุญููู ุงูุชุฑุจุฉ ุงูุญูููู -->
                        <div style="background: #e8f5e8; padding: 12px; border-radius: 8px; margin: 8px 0;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #2e7d32;">๐ฑ ุชุญููู ุงูุชุฑุจุฉ</div>
                            <div style="text-align: right; font-size: 0.85em; color: #666;">
                                <div style="display: flex; align-items: center; justify-content: space-between; margin: 5px 0;">
                                    <div style="display: flex; align-items: center;">
                                        <div style="width: 12px; height: 12px; background: ${soilColor}; border-radius: 50%; margin-left: 6px;"></div>
                                        <span>${soilFertility}</span>
                                    </div>
                                </div>
                                <strong>ููุน ุงูุชุฑุจุฉ:</strong> ${soilType}<br>
                                <strong>ุงููุฑุจูู ุงูุนุถูู:</strong> ${organicCarbon}<br>
                                <strong>ุงููุญุงุตูู ุงููููุตู ุจูุง:</strong> ${recommendedCrops}<br>
                                <strong>ูุธุงู ุงูุฑู:</strong> ${irrigation}
                            </div>
                        </div>

                        <!-- ุงูููุงุฎ ูุงูุทูุณ ุงููุญูู -->
                        <div style="background: #e3f2fd; padding: 12px; border-radius: 8px; margin: 8px 0;">
                            <div style="font-weight: bold; margin-bottom: 8px; color: #1976d2;">๐ค๏ธ ุงูููุงุฎ ูุงูุทูุณ</div>
                            <div style="font-size: 0.85em; color: #666; text-align: right;">
                                <strong>ููุน ุงูููุงุฎ:</strong> ${climate}<br>
                                <strong>ูุทูู ุงูุฃูุทุงุฑ:</strong> ${precipitation}<br>
                                <strong>ุงูุทูุณ ุงูุญุงูู:</strong> ${currentTemp}, ${currentHumidity}, ${currentWind}<br>
                                <strong>ุงูุญุงูุฉ:</strong> ${weatherCondition}
                            </div>
                        </div>

                        <!-- ุฃุฏูุงุช ุงูุฎุฑูุทุฉ -->
                        <div style="margin-top: 12px; display: flex; gap: 6px; justify-content: center; flex-wrap: wrap;">
                            <button onclick="
                                navigator.geolocation.getCurrentPosition(function(pos) {
                                    const distance = Math.round(
                                        L.latLng(pos.coords.latitude, pos.coords.longitude).distanceTo(L.latLng(${lat}, ${lng})) / 1000
                                    );
                                    alert('ุงููุณุงูุฉ ูู ูููุนู ุงูุญุงูู: ' + distance + ' ูู');
                                }, function() {
                                    alert('ูุง ูููู ุงููุตูู ููููุนู ุงูุญุงูู');
                                });
                            " style="background: #FF9800; color: white; border: none; padding: 6px 10px; border-radius: 4px; font-size: 0.75em; cursor: pointer;">
                                ๐ ููุงุณ ุงููุณุงูุฉ
                            </button>
                            <button onclick="
                                const coords = '${lat},${lng}';
                                navigator.clipboard.writeText(coords).then(() => {
                                    alert('ุชู ูุณุฎ ุงูุฅุญุฏุงุซูุงุช: ' + coords);
                                }).catch(() => {
                                    alert('ุงูุฅุญุฏุงุซูุงุช: ' + coords);
                                });
                            " style="background: #9C27B0; color: white; border: none; padding: 6px 10px; border-radius: 4px; font-size: 0.75em; cursor: pointer;">
                                ๐ ูุณุฎ ุงูุฅุญุฏุงุซูุงุช
                            </button>
                        </div>

                        <div style="margin-top: 10px; padding: 6px; background: #fff3e0; border-radius: 4px; font-size: 0.8em; color: #f57c00;">
                            ๐ก ูุนูู ุทุจูุงุช ุงูุชุฑุจุฉ ูุงูุทูุณ ููุฒูุฏ ูู ุงููุนูููุงุช
                        </div>
                    </div>
                `)
                .openOn(map);
        });

        // Layer events for better user experience
        map.on('overlayadd', function(e) {
            if (e.name.includes('ุงูุชุฑุจุฉ')) {
                console.log('๐ฑ Soil layer activated');
                alert('ุชู ุชูุนูู ุทุจูุฉ ุจูุงูุงุช ุงูุชุฑุจุฉ! ุงููุฑ ุนูู ุฃู ููุงู ูู ุงูุฎุฑูุทุฉ ูุงุณุชูุดุงู ุงูุจูุงูุงุช.');
            } else if (e.name.includes('ุงูุทูุณ') || e.name.includes('ุงูุฃูุทุงุฑ') || e.name.includes('ุงูุญุฑุงุฑุฉ') || e.name.includes('ุงูุฑูุงุญ') || e.name.includes('ุงูุบููู')) {
                console.log('๐ค๏ธ Weather layer activated');
            }
        });

        map.on('overlayremove', function(e) {
            console.log('Layer removed: ' + e.name);
        });

        // Console information
        console.log('๐พ Enhanced Farm Map Initialized!');
        console.log('๐ Centered on Algiers, Algeria');
        console.log('๐บ๏ธ Base layers: OSM and Satellite');
        console.log('๐ฑ Soil layer: ISRIC SoilGrids Organic Carbon Density');
        console.log('๐ค๏ธ Weather layers: OpenWeatherMap live data');
        console.log('๐จโ๐พ ' + farms.length + ' farm locations loaded');
        console.log('๐ Using OpenWeatherMap API for live weather data');
    </script>
</body>
</html>

<!-- 
๐ FUTURE ENHANCEMENTS:

1. **Leaflet.draw Integration:**
   Add this script: <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
   And CSS: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
   
   Then add drawing controls:
   const drawControl = new L.Control.Draw({
       edit: { featureGroup: drawnItems },
       draw: { polygon: true, rectangle: true, circle: true, marker: true }
   });
   map.addControl(drawControl);

2. **Weather Overlays:**
   Use OpenWeatherMap API for weather data:
   const weatherLayer = L.tileLayer('https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=YOUR_API_KEY');
   
   Add weather controls:
   const weatherLayers = {
       "๐ง๏ธ ูุทูู ุงูุฃูุทุงุฑ": precipitationLayer,
       "๐ก๏ธ ุฏุฑุฌุฉ ุงูุญุฑุงุฑุฉ": temperatureLayer,
       "๐จ ุณุฑุนุฉ ุงูุฑูุงุญ": windLayer
   };

3. **Real-time Data:**
   - Connect to IoT sensors for soil moisture, temperature
   - Add WebSocket connection for live updates
   - Integrate with weather APIs for forecasts

4. **Advanced Features:**
   - Crop health analysis using satellite imagery
   - Irrigation planning tools
   - Pest and disease tracking
   - Yield prediction models

5. **Database Integration:**
   - Connect to backend API for farm data
   - User authentication for farm management
   - Historical data visualization
   - Mobile app synchronization
-->