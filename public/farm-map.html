<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farm Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <!-- Custom Styles -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            text-align: center;
            padding: 30px 20px;
            font-size: 2.5em;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .map-container {
            padding: 20px;
            background: #f8f9fa;
        }
        
        #map {
            width: 100%;
            height: 600px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #4CAF50;
        }
        
        /* Custom popup styling */
        .leaflet-popup-content-wrapper {
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .farm-popup {
            text-align: center;
            font-family: 'Arial', sans-serif;
            direction: rtl;
        }
        
        .farm-popup h3 {
            color: #4CAF50;
            margin-bottom: 10px;
            font-size: 1.4em;
        }
        
        .farm-popup .crop-info {
            background: #f0f8f0;
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
        }
        
        .farm-popup .crop-type {
            color: #2e7d32;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .farm-popup .plant-date {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        /* Layer control styling */
        .leaflet-control-layers {
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Info panel */
        .info-panel {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
            direction: rtl;
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .feature {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #4CAF50;
            text-align: right;
        }
        
        .feature-icon {
            font-size: 1.5em;
            margin-left: 10px;
        }
        
        /* Soil Legend Styles */
        .legend {
            background: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            direction: rtl;
        }
        
        .legend-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #4CAF50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .legend-color {
            width: 30px;
            height: 20px;
            border-radius: 4px;
            margin-left: 10px;
            border: 1px solid #ddd;
        }
        
        .legend-text {
            flex: 1;
            font-size: 0.9em;
        }
        
        .weather-info {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            color: white;
            margin: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            direction: rtl;
            text-align: center;
        }
        
        .weather-current {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .weather-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .weather-value {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .weather-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            ğŸŒ¾ Interactive Farm Map
        </div>
        
        <!-- Map Container -->
        <div class="map-container">
            <div id="map"></div>
        </div>
        
        <!-- Info Panel -->
        <div class="info-panel">
            <h2>ğŸ—ºï¸ Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h2>
            <p>Ø§Ø³ØªÙƒØ´Ù Ø§Ù„Ù…Ø²Ø§Ø±Ø¹ ÙˆØ§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ© ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</p>
            
            <div class="features">
                <div class="feature">
                    <span class="feature-icon">ğŸŒ</span>
                    <strong>Ø¹Ø±Ø¶ Ø§Ù„Ø®Ø±ÙŠØ·Ø©:</strong> ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ© ÙˆØ§Ù„Ù‚Ù…Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠ
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸ“</span>
                    <strong>Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…Ø²Ø§Ø±Ø¹:</strong> Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸŒ¾</span>
                    <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„:</strong> Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØµÙˆÙ„ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ø±Ø§Ø¹Ø©
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸšœ</span>
                    <strong>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø²Ø§Ø±Ø¹:</strong> ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø­Ø§ØµÙŠÙ„ ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø²Ø±Ø§Ø¹ÙŠØ©
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸŒ±</span>
                    <strong>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø¨Ø©:</strong> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙƒØ«Ø§ÙØ© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ† Ø§Ù„Ø¹Ø¶ÙˆÙŠ
                </div>
                <div class="feature">
                    <span class="feature-icon">ğŸŒ¤ï¸</span>
                    <strong>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù‚Ø³:</strong> Ø¨ÙŠØ§Ù†Ø§Øª Ø¬ÙˆÙŠØ© Ø­ÙŠØ© ÙˆÙ…Ø­Ø¯Ø«Ø©
                </div>
            </div>
        </div>
        
        <!-- Weather Information Panel -->
        <div class="weather-info" id="weather-panel">
            <h2>ğŸŒ¤ï¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø­Ø§Ù„ÙŠØ© - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©</h2>
            <div class="weather-current" id="weather-data">
                <div class="weather-item">
                    <div class="weather-value" id="temperature">--Â°C</div>
                    <div class="weather-label">Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="humidity">--%</div>
                    <div class="weather-label">Ø§Ù„Ø±Ø·ÙˆØ¨Ø©</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="wind-speed">-- Ù…/Ø«</div>
                    <div class="weather-label">Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­</div>
                </div>
                <div class="weather-item">
                    <div class="weather-value" id="weather-desc">--</div>
                    <div class="weather-label">ÙˆØµÙ Ø§Ù„Ø·Ù‚Ø³</div>
                </div>
            </div>
        </div>
        
        <!-- Soil Carbon Legend -->
        <div class="legend">
            <div class="legend-title">ğŸŒ± Ø¯Ù„ÙŠÙ„ ÙƒØ«Ø§ÙØ© Ø§Ù„ÙƒØ±Ø¨ÙˆÙ† Ø§Ù„Ø¹Ø¶ÙˆÙŠ ÙÙŠ Ø§Ù„ØªØ±Ø¨Ø©</div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #8B4513;"></div>
                <div class="legend-text">
                    <strong>Ø¹Ø§Ù„ÙŠ Ø¬Ø¯Ø§Ù‹ (> 25 g/kg):</strong> ØªØ±Ø¨Ø© Ø®ØµØ¨Ø© Ø¬Ø¯Ø§Ù‹ØŒ Ù…Ø«Ø§Ù„ÙŠØ© Ù„Ù„Ø²Ø±Ø§Ø¹Ø© Ø§Ù„ÙƒØ«ÙŠÙØ©
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #A0522D;"></div>
                <div class="legend-text">
                    <strong>Ø¹Ø§Ù„ÙŠ (15-25 g/kg):</strong> ØªØ±Ø¨Ø© Ø®ØµØ¨Ø©ØŒ Ø¬ÙŠØ¯Ø© Ù„Ù„Ù…Ø­Ø§ØµÙŠÙ„ Ø§Ù„Ù…ØªÙ†ÙˆØ¹Ø©
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #CD853F;"></div>
                <div class="legend-text">
                    <strong>Ù…ØªÙˆØ³Ø· (8-15 g/kg):</strong> ØªØ±Ø¨Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø®ØµÙˆØ¨Ø©ØŒ ØªØ­ØªØ§Ø¬ ØªØ­Ø³ÙŠÙ†
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #F4A460;"></div>
                <div class="legend-text">
                    <strong>Ù…Ù†Ø®ÙØ¶ (3-8 g/kg):</strong> ØªØ±Ø¨Ø© Ø¶Ø¹ÙŠÙØ©ØŒ ØªØ­ØªØ§Ø¬ ØªØ³Ù…ÙŠØ¯ Ø¹Ø¶ÙˆÙŠ
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-color" style="background: #FFEFD5;"></div>
                <div class="legend-text">
                    <strong>Ù…Ù†Ø®ÙØ¶ Ø¬Ø¯Ø§Ù‹ (< 3 g/kg):</strong> ØªØ±Ø¨Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø© Ù„Ù„Ø²Ø±Ø§Ø¹Ø©
                </div>
            </div>
            
            <div style="margin-top: 15px; padding: 10px; background: #e8f5e8; border-radius: 8px; font-size: 0.9em;">
                <strong>ğŸ’¡ Ù…Ø¹Ù„ÙˆÙ…Ø© Ù…Ù‡Ù…Ø©:</strong> Ø§Ù„ÙƒØ±Ø¨ÙˆÙ† Ø§Ù„Ø¹Ø¶ÙˆÙŠ ÙÙŠ Ø§Ù„ØªØ±Ø¨Ø© Ù…Ø¤Ø´Ø± Ø­ÙŠÙˆÙŠ Ù„Ø®ØµÙˆØ¨Ø© Ø§Ù„Ø£Ø±Ø¶ ÙˆÙ‚Ø¯Ø±ØªÙ‡Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ù…Ø§Ø¡ ÙˆØ§Ù„Ù…ØºØ°ÙŠØ§Øª. 
                ÙƒÙ„Ù…Ø§ Ø²Ø§Ø¯ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø¹Ø¶ÙˆÙŠØŒ ÙƒØ§Ù†Øª Ø§Ù„ØªØ±Ø¨Ø© Ø£ÙƒØ«Ø± ØµØ­Ø© ÙˆØ¥Ù†ØªØ§Ø¬ÙŠØ©.
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <script>
        // Initialize map centered on Algiers, Algeria
        const map = L.map('map').setView([36.7538, 3.0588], 13);

        // Define base layers
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 19
        });

        // Esri Satellite imagery layer
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles Â© Esri â€” Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 19
        });

        // Add default layer (OSM)
        osmLayer.addTo(map);

        // ğŸŒ± SOIL DATA LAYER - ISRIC SoilGrids
        const soilLayer = L.tileLayer.wms('https://maps.isric.org/mapserv', {
            layers: 'ocd_0-5cm_mean',
            format: 'image/png',
            transparent: true,
            attribution: 'Soil data Â© ISRIC SoilGrids',
            opacity: 0.7,
            zIndex: 200
        });

        // ğŸŒ¤ï¸ WEATHER LAYERS - OpenWeatherMap
        const API_KEY = '06dbb6c0777805cea0cc1dcbeb83e18c';
        
        const precipitationLayer = L.tileLayer(`https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data Â© OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const temperatureLayer = L.tileLayer(`https://tile.openweathermap.org/map/temp_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data Â© OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const windLayer = L.tileLayer(`https://tile.openweathermap.org/map/wind_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data Â© OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        const cloudsLayer = L.tileLayer(`https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${API_KEY}`, {
            attribution: 'Weather data Â© OpenWeatherMap',
            opacity: 0.6,
            zIndex: 300
        });

        // Create base and overlay layer controls
        const baseLayers = {
            "ğŸ—ºï¸ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø¹Ø§Ø¯ÙŠØ©": osmLayer,
            "ğŸ›°ï¸ ØµÙˆØ± Ø§Ù„Ø£Ù‚Ù…Ø§Ø± Ø§Ù„ØµÙ†Ø§Ø¹ÙŠØ©": satelliteLayer
        };

        // ğŸŒ± CREATE VISIBLE SOIL DEMO LAYER
        const createSoilDemoLayer = () => {
            const soilDemoLayer = L.layerGroup();
            
            const soilZones = [
                {
                    center: [36.7538, 3.0588],
                    radius: 2000,
                    color: '#8B4513',
                    fillColor: '#8B4513',
                    fillOpacity: 0.3,
                    popup: 'Ù…Ù†Ø·Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© Ø§Ù„Ø®ØµÙˆØ¨Ø© - ÙƒØ«Ø§ÙØ© ÙƒØ±Ø¨ÙˆÙ† Ø¹Ø¶ÙˆÙŠ: 28 g/kg'
                },
                {
                    center: [36.7608, 3.0688],
                    radius: 1500,
                    color: '#A0522D',
                    fillColor: '#A0522D',
                    fillOpacity: 0.3,
                    popup: 'Ù…Ù†Ø·Ù‚Ø© Ø®ØµØ¨Ø© - ÙƒØ«Ø§ÙØ© ÙƒØ±Ø¨ÙˆÙ† Ø¹Ø¶ÙˆÙŠ: 18 g/kg'
                },
                {
                    center: [36.7458, 3.0488],
                    radius: 1800,
                    color: '#CD853F',
                    fillColor: '#CD853F',
                    fillOpacity: 0.3,
                    popup: 'Ù…Ù†Ø·Ù‚Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø®ØµÙˆØ¨Ø© - ÙƒØ«Ø§ÙØ© ÙƒØ±Ø¨ÙˆÙ† Ø¹Ø¶ÙˆÙŠ: 12 g/kg'
                },
                {
                    center: [36.7638, 3.0788],
                    radius: 1200,
                    color: '#F4A460',
                    fillColor: '#F4A460',
                    fillOpacity: 0.3,
                    popup: 'Ù…Ù†Ø·Ù‚Ø© Ø¶Ø¹ÙŠÙØ© Ø§Ù„Ø®ØµÙˆØ¨Ø© - ÙƒØ«Ø§ÙØ© ÙƒØ±Ø¨ÙˆÙ† Ø¹Ø¶ÙˆÙŠ: 6 g/kg'
                },
                {
                    center: [36.7338, 3.0388],
                    radius: 1000,
                    color: '#FFEFD5',
                    fillColor: '#FFEFD5',
                    fillOpacity: 0.4,
                    popup: 'Ù…Ù†Ø·Ù‚Ø© Ø¶Ø¹ÙŠÙØ© Ø¬Ø¯Ø§Ù‹ - ÙƒØ«Ø§ÙØ© ÙƒØ±Ø¨ÙˆÙ† Ø¹Ø¶ÙˆÙŠ: 2 g/kg'
                }
            ];

            soilZones.forEach(zone => {
                const circle = L.circle(zone.center, {
                    radius: zone.radius,
                    color: zone.color,
                    fillColor: zone.fillColor,
                    fillOpacity: zone.fillOpacity,
                    weight: 2
                }).bindPopup(`
                    <div style="text-align: center; direction: rtl;">
                        <h4>ğŸŒ± ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªØ±Ø¨Ø©</h4>
                        <p>${zone.popup}</p>
                        <div style="margin-top: 8px; padding: 6px; background: #e8f5e8; border-radius: 4px; font-size: 0.85em;">
                            ğŸ’¡ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù„Ù„Ù…Ù†Ø·Ù‚Ø©
                        </div>
                    </div>
                `);
                soilDemoLayer.addLayer(circle);
            });

            return soilDemoLayer;
        };

        const soilDemoLayer = createSoilDemoLayer();

        const overlayLayers = {
            "ğŸŒ± Ù…Ù†Ø§Ø·Ù‚ Ø®ØµÙˆØ¨Ø© Ø§Ù„ØªØ±Ø¨Ø© (ØªØ¬Ø±ÙŠØ¨ÙŠØ©)": soilDemoLayer,
            "ï¿½ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø¨Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©": soilLayer,
            "ï¿½ğŸŒ§ï¸ Ù‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø± (Ù…Ø¨Ø§Ø´Ø±)": precipitationLayer,
            "ğŸŒ¡ï¸ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Ù…Ø¨Ø§Ø´Ø±)": temperatureLayer,
            "ğŸ’¨ Ø§Ù„Ø±ÙŠØ§Ø­ (Ù…Ø¨Ø§Ø´Ø±)": windLayer,
            "â˜ï¸ Ø§Ù„ØºÙŠÙˆÙ… (Ù…Ø¨Ø§Ø´Ø±)": cloudsLayer
        };

        // Add layer control with overlays
        L.control.layers(baseLayers, overlayLayers, {
            position: 'topright',
            collapsed: false
        }).addTo(map);

        // Add demo soil layer by default so users see it immediately!
        soilDemoLayer.addTo(map);
        
        // Also add precipitation layer for immediate visual impact
        precipitationLayer.addTo(map);

        // Custom farm icon
        const farmIcon = L.divIcon({
            html: '<div style="background: #4CAF50; color: white; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.3); border: 3px solid white;">ğŸŒ¾</div>',
            iconSize: [40, 40],
            className: 'custom-farm-icon'
        });

        // Add farm markers with detailed information
        const farms = [
            {
                coords: [36.7538, 3.0588],
                name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø£Ù…Ù„",
                crop: "Ø§Ù„Ù‚Ù…Ø­",
                plantedDate: "Ù…Ø§Ø±Ø³ 2024",
                area: "15 Ù‡ÙƒØªØ§Ø±",
                owner: "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯"
            },
            {
                coords: [36.7608, 3.0688],
                name: "Ø­Ù‚Ù„ Ø§Ù„Ø²ÙŠØªÙˆÙ† Ø§Ù„Ù…Ø¨Ø§Ø±Ùƒ",
                crop: "Ø£Ø´Ø¬Ø§Ø± Ø§Ù„Ø²ÙŠØªÙˆÙ†",
                plantedDate: "Ø£ÙƒØªÙˆØ¨Ø± 2020",
                area: "8 Ù‡ÙƒØªØ§Ø±",
                owner: "ÙØ§Ø·Ù…Ø© Ø¨Ù† Ø¹Ù„ÙŠ"
            },
            {
                coords: [36.7458, 3.0488],
                name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ù†Ø¬Ø§Ø­",
                crop: "Ø§Ù„Ø·Ù…Ø§Ø·Ù…",
                plantedDate: "Ø£Ø¨Ø±ÙŠÙ„ 2024",
                area: "3 Ù‡ÙƒØªØ§Ø±",
                owner: "Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù† Ù…Ø­Ù…ÙˆØ¯"
            },
            {
                coords: [36.7638, 3.0788],
                name: "Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø±ÙƒØ©",
                crop: "Ø§Ù„Ø°Ø±Ø©",
                plantedDate: "Ù…Ø§ÙŠÙˆ 2024",
                area: "12 Ù‡ÙƒØªØ§Ø±",
                owner: "Ø®Ø¯ÙŠØ¬Ø© ÙŠÙˆØ³Ù"
            },
            {
                coords: [36.7338, 3.0388],
                name: "Ù…Ø²Ø±Ø¹Ø© Ø§Ù„Ø®ÙŠØ±",
                crop: "Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„",
                plantedDate: "Ù†ÙˆÙÙ…Ø¨Ø± 2021",
                area: "6 Ù‡ÙƒØªØ§Ø±",
                owner: "Ø£Ø­Ù…Ø¯ Ø§Ù„Ø¹Ø±Ø¨ÙŠ"
            }
        ];

        // Add markers to map
        farms.forEach(farm => {
            const marker = L.marker(farm.coords, { icon: farmIcon }).addTo(map);
            
            const popupContent = `
                <div class="farm-popup">
                    <h3>ğŸŒ¾ ${farm.name}</h3>
                    <div class="crop-info">
                        <div class="crop-type">ğŸŒ± Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­ØµÙˆÙ„: ${farm.crop}</div>
                        <div class="plant-date">ğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø²Ø±Ø§Ø¹Ø©: ${farm.plantedDate}</div>
                        <div class="plant-date">ğŸ“ Ø§Ù„Ù…Ø³Ø§Ø­Ø©: ${farm.area}</div>
                        <div class="plant-date">ğŸ‘¨â€ğŸŒ¾ Ø§Ù„Ù…Ø§Ù„Ùƒ: ${farm.owner}</div>
                    </div>
                    <div style="margin-top: 10px; padding: 8px; background: #e8f5e8; border-radius: 5px; font-size: 0.9em;">
                        ğŸ’¡ Ø§Ù†Ù‚Ø± Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„ØªÙØ§ØµÙŠÙ„
                    </div>
                </div>
            `;
            
            marker.bindPopup(popupContent, {
                maxWidth: 300,
                className: 'custom-popup'
            });
        });

        // Add a scale control
        L.control.scale().addTo(map);

        // Add custom zoom control with Arabic labels
        map.removeControl(map.zoomControl);
        L.control.zoom({
            zoomInTitle: 'ØªÙƒØ¨ÙŠØ±',
            zoomOutTitle: 'ØªØµØºÙŠØ±'
        }).addTo(map);

        // Add location marker for current position (if available)
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const userLat = position.coords.latitude;
                const userLng = position.coords.longitude;
                
                const userIcon = L.divIcon({
                    html: '<div style="background: #ff4444; color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); border: 2px solid white;">ğŸ“</div>',
                    iconSize: [20, 20],
                    className: 'user-location-icon'
                });
                
                L.marker([userLat, userLng], { icon: userIcon })
                    .addTo(map)
                    .bindPopup('ğŸ“ Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ')
                    .openPopup();
            });
        }

        // ğŸŒ¤ï¸ FETCH LIVE WEATHER DATA
        async function fetchWeatherData() {
            try {
                const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=36.7538&lon=3.0588&appid=${API_KEY}&units=metric&lang=ar`);
                const data = await response.json();
                
                // Update weather display
                document.getElementById('temperature').textContent = `${Math.round(data.main.temp)}Â°C`;
                document.getElementById('humidity').textContent = `${data.main.humidity}%`;
                document.getElementById('wind-speed').textContent = `${data.wind.speed} Ù…/Ø«`;
                document.getElementById('weather-desc').textContent = data.weather[0].description;
                
                console.log('ğŸŒ¤ï¸ Weather data loaded successfully!');
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³:', error);
                document.getElementById('temperature').textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                document.getElementById('humidity').textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                document.getElementById('wind-speed').textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
                document.getElementById('weather-desc').textContent = 'ØºÙŠØ± Ù…ØªÙˆÙØ±';
            }
        }

        // Load weather data on page load
        fetchWeatherData();
        
        // Update weather data every 10 minutes
        setInterval(fetchWeatherData, 600000);

        // Enhanced map click event with soil data info
        map.on('click', async function(e) {
            console.log('ğŸ“ Map clicked at: ' + e.latlng);
            
            // Show clicked location popup with coordinates
            const popup = L.popup()
                .setLatLng(e.latlng)
                .setContent(`
                    <div style="text-align: center; direction: rtl;">
                        <h4>ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯</h4>
                        <p><strong>Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶:</strong> ${e.latlng.lat.toFixed(4)}</p>
                        <p><strong>Ø®Ø· Ø§Ù„Ø·ÙˆÙ„:</strong> ${e.latlng.lng.toFixed(4)}</p>
                        <div style="margin-top: 10px; padding: 8px; background: #e3f2fd; border-radius: 5px; font-size: 0.9em;">
                            ğŸ’¡ ÙØ¹Ù‘Ù„ Ø·Ø¨Ù‚Ø© Ø§Ù„ØªØ±Ø¨Ø© Ù„Ø±Ø¤ÙŠØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙƒØ±Ø¨ÙˆÙ† Ø§Ù„Ø¹Ø¶ÙˆÙŠ
                        </div>
                    </div>
                `)
                .openOn(map);
        });

        // Layer events for better user experience
        map.on('overlayadd', function(e) {
            if (e.name.includes('Ø§Ù„ØªØ±Ø¨Ø©')) {
                console.log('ğŸŒ± Soil layer activated');
                alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø·Ø¨Ù‚Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ±Ø¨Ø©! Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† ÙÙŠ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„Ø§Ø³ØªÙƒØ´Ø§Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.');
            } else if (e.name.includes('Ø§Ù„Ø·Ù‚Ø³') || e.name.includes('Ø§Ù„Ø£Ù…Ø·Ø§Ø±') || e.name.includes('Ø§Ù„Ø­Ø±Ø§Ø±Ø©') || e.name.includes('Ø§Ù„Ø±ÙŠØ§Ø­') || e.name.includes('Ø§Ù„ØºÙŠÙˆÙ…')) {
                console.log('ğŸŒ¤ï¸ Weather layer activated');
            }
        });

        map.on('overlayremove', function(e) {
            console.log('Layer removed: ' + e.name);
        });

        // Console information
        console.log('ğŸŒ¾ Enhanced Farm Map Initialized!');
        console.log('ğŸ“ Centered on Algiers, Algeria');
        console.log('ğŸ—ºï¸ Base layers: OSM and Satellite');
        console.log('ğŸŒ± Soil layer: ISRIC SoilGrids Organic Carbon Density');
        console.log('ğŸŒ¤ï¸ Weather layers: OpenWeatherMap live data');
        console.log('ğŸ‘¨â€ğŸŒ¾ ' + farms.length + ' farm locations loaded');
        console.log('ğŸ”‘ Using OpenWeatherMap API for live weather data');
    </script>
</body>
</html>

<!-- 
ğŸš€ FUTURE ENHANCEMENTS:

1. **Leaflet.draw Integration:**
   Add this script: <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
   And CSS: <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css"/>
   
   Then add drawing controls:
   const drawControl = new L.Control.Draw({
       edit: { featureGroup: drawnItems },
       draw: { polygon: true, rectangle: true, circle: true, marker: true }
   });
   map.addControl(drawControl);

2. **Weather Overlays:**
   Use OpenWeatherMap API for weather data:
   const weatherLayer = L.tileLayer('https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=YOUR_API_KEY');
   
   Add weather controls:
   const weatherLayers = {
       "ğŸŒ§ï¸ Ù‡Ø·ÙˆÙ„ Ø§Ù„Ø£Ù…Ø·Ø§Ø±": precipitationLayer,
       "ğŸŒ¡ï¸ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©": temperatureLayer,
       "ğŸ’¨ Ø³Ø±Ø¹Ø© Ø§Ù„Ø±ÙŠØ§Ø­": windLayer
   };

3. **Real-time Data:**
   - Connect to IoT sensors for soil moisture, temperature
   - Add WebSocket connection for live updates
   - Integrate with weather APIs for forecasts

4. **Advanced Features:**
   - Crop health analysis using satellite imagery
   - Irrigation planning tools
   - Pest and disease tracking
   - Yield prediction models

5. **Database Integration:**
   - Connect to backend API for farm data
   - User authentication for farm management
   - Historical data visualization
   - Mobile app synchronization
-->